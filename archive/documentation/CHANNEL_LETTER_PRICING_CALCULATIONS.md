# Channel Letter Pricing Calculations - Complete Documentation

## Rate Structure (Configurable Values)

### Channel Letter Types (B57-B87)
| Type | Price/Inch | LED Default | LED Multi |
|------|------------|-------------|-----------|
| 3" Front Lit | $4.50 | Default | 0.7 |
| 4" Front Lit | $5.00 | Default | 0.7 |
| 5" Front Lit | $5.50 | Default | 0.7 |
| 3" Halo Lit | $8.50 | Default | 1.0 |
| 4" Halo Lit | $9.00 | Default | 1.0 |
| 5" Halo Lit | $9.50 | Default | 1.0 |
| 3" Dual Lit 2 Layer | $8.00 | Batwing | 1.7 |
| 4" Dual Lit 2 Layer | $8.50 | Default | 1.7 |
| 5" Dual Lit 2 Layer | $9.00 | Default | 1.7 |
| 3" Dual Lit 1 Layer | $6.50 | Default | 1.0 |
| 4" Dual Lit 1 Layer | $7.00 | Default | 1.0 |
| 5" Dual Lit 1 Layer | $7.50 | Default | 1.0 |
| Metal Signs | $21.60 | Default | 1.0 |
| 35mm Trimless Front Lit | $8.90 | Strip LED | 1.0 |
| 60mm Trimless Front Lit | $9.50 | Strip LED | 1.0 |
| 35mm Trimless Halo Lit | $8.90 | Batwing | 1.0 |
| 60mm Trimless Halo Lit | $9.50 | Default | 1.0 |
| 35mm Tless F&H Lit | $9.40 | Strip LED | 1.25 |
| 60mm Tless F&H Lit | $10.00 | Strip LED | 1.25 |
| 4" Marquee Letter | $7.70 | Small Bulb | 0.7 |
| 3D Print Sign | $7.50 | Strip LED | 1.0 |
| 3" Trimless Letters | $8.50 | Default | 0.7 |
| 4" Trimless Letters | $9.00 | Default | 0.7 |
| 5" Trimless Letters | $9.50 | Default | 0.7 |
| 3" Return | $2.30 | Default | 0.7 |
| 4" Return | $2.80 | Default | 0.7 |
| 5" Return | $3.30 | Default | 0.7 |
| Trim Cap | $2.80 | Default | - |
| 3" Trimless Dual Lit | $10.50 | Default | 1.0 |
| 4" Trimless Dual Lit | $11.00 | Default | 1.0 |
| 5" Trimless Dual Lit | $11.50 | Default | 1.0 |

### LED Types (C3-E50)
| LED Type | Price | Watts | Color/Temp | Voltage |
|----------|-------|-------|------------|---------|
| Default Integra 3 | $1.75 | 1.0 | Cool White | 12V |
| Hanley 2080 7k | $2.00 | 0.8 | 7000K | 12V |
| Hanley 2080 RED | $2.00 | 0.8 | Red | 12V |
| Hanley 2080 GREEN | $2.00 | 0.8 | Green | 12V |
| Hanley 2080 Blue | $2.00 | 0.8 | Blue | 12V |
| Batwing 6500K | $2.40 | 0.73 | 6500K | 12V |
| Strip LED | $2.50 | 0.5 | 3000K-RGB | 12V |
| Small Bulb | $11.00 | 1.4 | - | 24V |
| Big Bulb | $12.00 | 2.0 | - | 24V |
| LED Neon | $11.00 | 4.8 | Per Foot | 12V |
| Hanley RGB LEDs | $3.00 | 1.0 | RGB | 12V |
| Mini Leds PF-2030 | $3.75 | 0.9 | Pure White | 12V |
| Strip RGB LED | $3.60 | 1.0 | RGB | 12V |
| Strip LED / Inch | $0.50 | 0.15 | - | 12V |
| Spark3 10K 1W | $1.75 | 1.0 | White | 12V |
| Spark3 10K 1.2W | $1.75 | 1.2 | 10,000K | 12V |
| PS St Fight 1dot | $1.75 | 0.8 | 7000K | 12V |
| PS St Fight 2dot | $1.95 | 1.2 | 7000K | 12V |
| Batwing 3000K | $2.40 | 0.73 | 3000K | 12V |
| Hnly NRG 4K 24V | $3.75 | 0.62 | 4000K | 24V |
| Strip 3k | $2.50 | 0.5 | 3000K | 12V |
| Strip 6.5K | $2.50 | 0.5 | 6500K | 12V |
| DCOB 3k | $2.50 | 0.5 | 3000K | 12V |
| DCOB 6.5k | $2.50 | 0.5 | 6500K | 12V |
| Interone 7K | $1.75 | 0.8 | 6500-7000K | 12V |

### Transformer Types (B109-D135)
| Type | Price | Watts | Rated W | Voltage |
|------|-------|-------|---------|---------|
| Plain, No Box | $35 | 50 | 60 | 12V |
| Speedbox 60W | $120 | 50 | 60 | 12V |
| Speedbox 150W | $180 | 120 | 150 | 12V |
| HanleyLED | $40 | 50 | 60 | 12V |
| RGB Hanley | $55 | 50 | 60 | 12V |
| RGB + Speed box | $120 | 50 | 60 | 12V |
| Mini | $80 | 50 | 60 | 12V |
| Speedbox 150W Hnly | $120 | 120 | 150 | 12V |
| Speedbox 60W Hnly | $80 | 50 | 60 | 12V |
| Si Supply + RGB Hanley | $90 | 50 | 60 | 12V |
| 24V SpdBox 192W | $275 | 154 | 192 | 24V |
| 24V SpdBox 96W | $150 | 77 | 96 | 24V |
| Si Supply | $35 | 50 | 60 | 12V |
| Hanley 347V 60W + box | $140 | 50 | 60 | 12V |

### Fixed Rates
| Rate | Value | Description |
|------|-------|-------------|
| UL_BASE | $150 | First UL listing per job (I$108) |
| UL_ADDITIONAL | $50 | Additional UL listings same job (I$109) |
| WIRE_PER_INCH | $0.0583 | Wire cost per inch (C$225) |
| CONNECTORS | $15 | Connector cost |
| WALL_PLUG | $20 | Wall plug cost |
| TRANSFORMER_THRESHOLD_1 | 50W | SpeedBox 60W threshold (D$110) |
| TRANSFORMER_THRESHOLD_2 | 120W | SpeedBox 150W threshold (D$111) |

## Calculation Logic

### 1. Channel Letter Base Calculation
**Formula**: `inches * channel_type_rate_per_inch`

**Logic**:
- Input: Dimensions as comma-separated values (e.g., "9,9,9,5,5,5")
- Parse using TEXTSPLIT, sum all dimensions
- Lookup channel type rate from Channel Types table
- Multiply total inches by rate per inch

### 2. LED Count Calculation
**Complex Logic with Multiple Scenarios**:

```
IF input_override != "":
    IF input_override.lower() == "yes":
        LED_count = auto_calculated_LED_count
    ELSE:
        LED_count = input_override (numeric)
ELSE IF customer_default_no_LEDs:
    LED_count = 0
ELSE IF dimension_input exists:
    LED_count = auto_calculated_LED_count
ELSE:
    LED_count = ROUNDUP(total_inches * 0.7, 0)
```

**Auto-calculated LED Count**:
- Parse dimensions with TEXTSPLIT
- If rows > 1 (multiple letters): `SUM(letter_dimensions * LED_multiplier / 0.7)`
- LED_multiplier comes from Channel Type table
- Round up to whole LEDs

### 3. LED Type Selection Priority
1. **Item Override**: Specific LED type for this item
2. **Channel Default**: LED default from Channel Type table
3. **Job Default**: Job-level LED preference
4. **System Default**: "Default Integra 3"

### 4. LED Pricing Calculation
**Formula**: `LED_count * LED_unit_price`
- LED_unit_price from LED Types table
- LED_total_watts = LED_count * LED_watts_per_unit

### 5. Transformer Calculation
**Complex Wattage-Based Logic**:

```
total_watts = LED_total_watts
required_transformers = total_watts / transformer_rated_watts

IF transformer_type == "Speedbox":
    IF total_watts > TRANSFORMER_THRESHOLD_2 (120W):
        transformers_needed = ROUNDDOWN(required_transformers) + 
                             (MOD(required_transformers, 1) > threshold ? 1 : rounding_logic)
    ELSE:
        transformers_needed = ROUNDUP(required_transformers)
ELSE:
    transformers_needed = ROUNDUP(required_transformers)
```

### 6. Transformer Type Selection Priority
1. **Item Override**: Specific transformer for this item
2. **Speedbox Logic**: Auto-select based on wattage thresholds
3. **Job Default**: Job-level transformer preference
4. **Channel Default**: From UL requirements and wattage

### 7. UL Listing Calculation
**Job-Level Logic**:

```
UL_cost = 0

IF item_requires_UL AND NOT job_UL_override_false:
    IF this_is_first_UL_item_in_job:
        UL_cost = UL_BASE ($150)
        IF LED_count > 0:
            UL_cost += UL_ADDITIONAL ($50) * UL_set_count
    ELSE:
        UL_cost = UL_ADDITIONAL ($50) * UL_set_count
```

**UL Set Count**: `UL_counter * 1` (each item counts as 1 set)

### 8. Extra Wire Calculation
**Formula**: `letter_count * wire_feet_per_letter * WIRE_PER_INCH * 12`
- Input: Extra wire feet per piece
- Convert to inches, multiply by wire rate
- Applied per letter piece

### 9. Pin Cost (Mounting Hardware)
**Simple Addition**: Direct cost input for mounting pins

## Input Processing Examples

### Dimension Input: "9,9,9,5,5,5"
```
TEXTSPLIT("9,9,9,5,5,5", ",") = [9,9,9,5,5,5]
total_inches = 9+9+9+5+5+5 = 42 inches
letter_count = COUNT(array) = 6 letters
```

### LED Override Examples:
- **Blank**: Use auto-calculation or customer default
- **"yes"**: Use auto-calculated LED count  
- **"15"**: Use exactly 15 LEDs
- **"0"**: No LEDs

### Complex Tab-Separated Input:
```
Input: "9	5\n9	5\n9	5" (tab-separated with newlines)
Parse as: [[9,5], [9,5], [9,5]]
total_inches = (9+9+9) = 27 inches from first column
LED_calculation_base = (5+5+5) = 15 from second column
```

## Database Schema Requirements

### Enhanced Channel Letter Tables

```sql
CREATE TABLE channel_letter_types (
  id INT PRIMARY KEY AUTO_INCREMENT,
  type_name VARCHAR(100) NOT NULL,
  type_code VARCHAR(20) UNIQUE NOT NULL,
  base_rate_per_inch DECIMAL(8,4) NOT NULL,
  led_default VARCHAR(50), -- References led_types.led_name
  led_multiplier DECIMAL(4,2) DEFAULT 1.0,
  effective_date DATE NOT NULL,
  is_active BOOLEAN DEFAULT true
);

CREATE TABLE led_types (
  id INT PRIMARY KEY AUTO_INCREMENT,
  led_name VARCHAR(100) UNIQUE NOT NULL,
  led_code VARCHAR(20) UNIQUE NOT NULL,
  unit_price DECIMAL(8,4) NOT NULL,
  watts_per_unit DECIMAL(6,3) NOT NULL,
  color_temp VARCHAR(50),
  voltage INT DEFAULT 12,
  lumens INT,
  effective_date DATE NOT NULL,
  is_active BOOLEAN DEFAULT true
);

CREATE TABLE transformer_types (
  id INT PRIMARY KEY AUTO_INCREMENT,
  transformer_name VARCHAR(100) UNIQUE NOT NULL,
  transformer_code VARCHAR(20) UNIQUE NOT NULL,
  unit_price DECIMAL(8,4) NOT NULL,
  rated_watts INT NOT NULL,
  max_watts INT NOT NULL,
  voltage INT DEFAULT 12,
  effective_date DATE NOT NULL,
  is_active BOOLEAN DEFAULT true
);

CREATE TABLE channel_letter_pricing_config (
  id INT PRIMARY KEY AUTO_INCREMENT,
  config_key VARCHAR(50) UNIQUE NOT NULL,
  config_value DECIMAL(10,6) NOT NULL,
  config_description VARCHAR(200),
  effective_date DATE NOT NULL,
  is_active BOOLEAN DEFAULT true
);
```

### Configuration Data
```sql
INSERT INTO channel_letter_pricing_config VALUES
(1, 'UL_BASE_COST', 150.0000, 'First UL listing per job', '2025-09-01', true),
(2, 'UL_ADDITIONAL_COST', 50.0000, 'Additional UL listings same job', '2025-09-01', true),
(3, 'WIRE_COST_PER_INCH', 0.058333, 'Wire cost per inch', '2025-09-01', true),
(4, 'CONNECTOR_COST', 15.0000, 'Connector cost', '2025-09-01', true),
(5, 'WALL_PLUG_COST', 20.0000, 'Wall plug cost', '2025-09-01', true),
(6, 'TRANSFORMER_THRESHOLD_1', 50.0000, 'SpeedBox 60W threshold', '2025-09-01', true),
(7, 'TRANSFORMER_THRESHOLD_2', 120.0000, 'SpeedBox 150W threshold', '2025-09-01', true);
```

## Calculation Engine Implementation

The calculation engine must handle:
1. **Complex input parsing** (comma-separated, tab-separated)
2. **Multi-level defaulting** (item → channel → job → system)  
3. **Conditional LED calculations** with override logic
4. **Wattage-based transformer selection** with special Speedbox logic
5. **Job-level UL tracking** for first vs additional items
6. **Wire calculations** with per-piece multipliers

This documentation captures the complete Channel Letter pricing system with all Excel formula logic preserved for database implementation.